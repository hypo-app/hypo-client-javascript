!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).hypo=r()}(this,(function(){"use strict";var e=require("../internals/export"),r=require("../internals/fails"),t=require("../internals/is-array"),n=require("../internals/is-object"),i=require("../internals/to-object"),o=require("../internals/to-length"),a=require("../internals/create-property"),s=require("../internals/array-species-create"),u=require("../internals/array-method-has-species-support"),c=require("../internals/well-known-symbol"),l=require("../internals/engine-v8-version"),f=c("isConcatSpreadable"),p=l>=51||!r((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),d=u("concat"),v=function(e){if(!n(e))return!1;var r=e[f];return void 0!==r?!!r:t(e)};e({target:"Array",proto:!0,forced:!p||!d},{concat:function(e){var r,t,n,u,c,l=i(this),f=s(l,0),p=0;for(r=-1,n=arguments.length;r<n;r++)if(c=-1===r?l:arguments[r],v(c)){if(p+(u=o(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(t=0;t<u;t++,p++)t in c&&a(f,p,c[t])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");a(f,p++,c)}return f.length=p,f}});var h=require("../internals/export"),m=require("../internals/array-iteration").map,g=require("../internals/array-method-has-species-support"),y=require("../internals/array-method-uses-to-length"),q=g("map"),w=y("map");h({target:"Array",proto:!0,forced:!q||!w},{map:function(e){return m(this,e,arguments.length>1?arguments[1]:void 0)}});var b=require("../internals/export"),j=require("../internals/to-object"),x=require("../internals/object-keys");b({target:"Object",stat:!0,forced:require("../internals/fails")((function(){x(1)}))},{keys:function(e){return x(j(e))}});var O=require("../internals/to-string-tag-support"),P=require("../internals/redefine"),k=require("../internals/object-to-string");O||P(Object.prototype,"toString",k,{unsafe:!0});var E,S,T,D,H=require("../internals/export"),C=require("../internals/is-pure"),I=require("../internals/global"),M=require("../internals/get-built-in"),R=require("../internals/native-promise-constructor"),U=require("../internals/redefine"),X=require("../internals/redefine-all"),A=require("../internals/set-to-string-tag"),J=require("../internals/set-species"),N=require("../internals/is-object"),G=require("../internals/a-function"),L=require("../internals/an-instance"),V=require("../internals/classof-raw"),_=require("../internals/inspect-source"),F=require("../internals/iterate"),$=require("../internals/check-correctness-of-iteration"),z=require("../internals/species-constructor"),B=require("../internals/task").set,K=require("../internals/microtask"),Q=require("../internals/promise-resolve"),W=require("../internals/host-report-errors"),Y=require("../internals/new-promise-capability"),Z=require("../internals/perform"),ee=require("../internals/internal-state"),re=require("../internals/is-forced"),te=require("../internals/well-known-symbol"),ne=require("../internals/engine-v8-version"),ie=te("species"),oe="Promise",ae=ee.get,se=ee.set,ue=ee.getterFor(oe),ce=R,le=I.TypeError,fe=I.document,pe=I.process,de=M("fetch"),ve=Y.f,he=ve,me="process"==V(pe),ge=!!(fe&&fe.createEvent&&I.dispatchEvent),ye=re(oe,(function(){if(!(_(ce)!==String(ce))){if(66===ne)return!0;if(!me&&"function"!=typeof PromiseRejectionEvent)return!0}if(C&&!ce.prototype.finally)return!0;if(ne>=51&&/native code/.test(ce))return!1;var e=ce.resolve(1),r=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ie]=r,!(e.then((function(){}))instanceof r)})),qe=ye||!$((function(e){ce.all(e).catch((function(){}))})),we=function(e){var r;return!(!N(e)||"function"!=typeof(r=e.then))&&r},be=function(e,r,t){if(!r.notified){r.notified=!0;var n=r.reactions;K((function(){for(var i=r.value,o=1==r.state,a=0;n.length>a;){var s,u,c,l=n[a++],f=o?l.ok:l.fail,p=l.resolve,d=l.reject,v=l.domain;try{f?(o||(2===r.rejection&&Pe(e,r),r.rejection=1),!0===f?s=i:(v&&v.enter(),s=f(i),v&&(v.exit(),c=!0)),s===l.promise?d(le("Promise-chain cycle")):(u=we(s))?u.call(s,p,d):p(s)):d(i)}catch(e){v&&!c&&v.exit(),d(e)}}r.reactions=[],r.notified=!1,t&&!r.rejection&&xe(e,r)}))}},je=function(e,r,t){var n,i;ge?((n=fe.createEvent("Event")).promise=r,n.reason=t,n.initEvent(e,!1,!0),I.dispatchEvent(n)):n={promise:r,reason:t},(i=I["on"+e])?i(n):"unhandledrejection"===e&&W("Unhandled promise rejection",t)},xe=function(e,r){B.call(I,(function(){var t,n=r.value;if(Oe(r)&&(t=Z((function(){me?pe.emit("unhandledRejection",n,e):je("unhandledrejection",e,n)})),r.rejection=me||Oe(r)?2:1,t.error))throw t.value}))},Oe=function(e){return 1!==e.rejection&&!e.parent},Pe=function(e,r){B.call(I,(function(){me?pe.emit("rejectionHandled",e):je("rejectionhandled",e,r.value)}))},ke=function(e,r,t,n){return function(i){e(r,t,i,n)}},Ee=function(e,r,t,n){r.done||(r.done=!0,n&&(r=n),r.value=t,r.state=2,be(e,r,!0))},Se=function(e,r,t,n){if(!r.done){r.done=!0,n&&(r=n);try{if(e===t)throw le("Promise can't be resolved itself");var i=we(t);i?K((function(){var n={done:!1};try{i.call(t,ke(Se,e,n,r),ke(Ee,e,n,r))}catch(t){Ee(e,n,t,r)}})):(r.value=t,r.state=1,be(e,r,!1))}catch(t){Ee(e,{done:!1},t,r)}}};ye&&(ce=function(e){L(this,ce,oe),G(e),E.call(this);var r=ae(this);try{e(ke(Se,this,r),ke(Ee,this,r))}catch(e){Ee(this,r,e)}},(E=function(e){se(this,{type:oe,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=X(ce.prototype,{then:function(e,r){var t=ue(this),n=ve(z(this,ce));return n.ok="function"!=typeof e||e,n.fail="function"==typeof r&&r,n.domain=me?pe.domain:void 0,t.parent=!0,t.reactions.push(n),0!=t.state&&be(this,t,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),S=function(){var e=new E,r=ae(e);this.promise=e,this.resolve=ke(Se,e,r),this.reject=ke(Ee,e,r)},Y.f=ve=function(e){return e===ce||e===T?new S(e):he(e)},C||"function"!=typeof R||(D=R.prototype.then,U(R.prototype,"then",(function(e,r){var t=this;return new ce((function(e,r){D.call(t,e,r)})).then(e,r)}),{unsafe:!0}),"function"==typeof de&&H({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Q(ce,de.apply(I,arguments))}}))),H({global:!0,wrap:!0,forced:ye},{Promise:ce}),A(ce,oe,!1,!0),J(oe),T=M(oe),H({target:oe,stat:!0,forced:ye},{reject:function(e){var r=ve(this);return r.reject.call(void 0,e),r.promise}}),H({target:oe,stat:!0,forced:C||ye},{resolve:function(e){return Q(C&&this===T?ce:this,e)}}),H({target:oe,stat:!0,forced:qe},{all:function(e){var r=this,t=ve(r),n=t.resolve,i=t.reject,o=Z((function(){var t=G(r.resolve),o=[],a=0,s=1;F(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,t.call(r,e).then((function(e){c||(c=!0,o[u]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),t.promise},race:function(e){var r=this,t=ve(r),n=t.reject,i=Z((function(){var i=G(r.resolve);F(e,(function(e){i.call(r,e).then(t.resolve,n)}))}));return i.error&&n(i.value),t.promise}});var Te=require("../internals/export"),De=require("../internals/regexp-exec");Te({target:"RegExp",proto:!0,forced:/./.exec!==De},{exec:De});var He=require("../internals/fix-regexp-well-known-symbol-logic"),Ce=require("../internals/an-object"),Ie=require("../internals/to-length"),Me=require("../internals/require-object-coercible"),Re=require("../internals/advance-string-index"),Ue=require("../internals/regexp-exec-abstract");function Xe(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Ae(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Je(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Ae(Object(t),!0).forEach((function(r){Xe(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ae(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Ne(e,r,t){var n=new Date;n.setTime(n.getTime()+36e5*t);var i=e+"="+r+";path=/;expires="+n.toGMTString();_e.cookieDomain&&(i+=";domain="+_e.cookieDomain),document.cookie=i}function Ge(e,r){"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(e,JSON.stringify(r))}function Le(e){return"undefined"!=typeof window&&window.localStorage?JSON.parse(window.localStorage.getItem(e)):null}function Ve(e){if("undefined"!=typeof window&&window.localStorage)return window.localStorage.removeItem(e)}He("match",1,(function(e,r,t){return[function(r){var t=Me(this),n=null==r?void 0:r[e];return void 0!==n?n.call(r,t):new RegExp(r)[e](String(t))},function(e){var n=t(r,e,this);if(n.done)return n.value;var i=Ce(e),o=String(this);if(!i.global)return Ue(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],c=0;null!==(s=Ue(i,o));){var l=String(s[0]);u[c]=l,""===l&&(i.lastIndex=Re(o,Ie(i.lastIndex),a)),c++}return 0===c?null:u}]}));var _e={cookiePrefix:"hypo",baseUrl:"https://api.hypo.app",project:null,userIdCacheDurationHours:17520,groupAssignmentCacheDurationHours:6,cookieDomain:null,requestTimeoutMs:5e3};function Fe(){var e,r,t=_e.cookiePrefix+"-uid";return e=t,(r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)"))?r[2]:null}return{init:function(e){_e=Je(Je({},_e),e)},getUserId:Fe,setUserId:function(e){Ne(_e.cookiePrefix+"-uid",e,_e.userIdCacheDurationHours)},getGroupAssignment:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=_e.cookiePrefix+"-eid-"+e,n=_e.cookiePrefix+"-uid",i=Fe(),o=Le(t);if(o)if((new Date).getTime()<o.expirationTime&&i===o.user){if(!r)return Promise.resolve(o)}else Ve(t);var a="{}";i&&(a=JSON.stringify({user:i}));var s="".concat(_e.baseUrl,"/project/").concat(_e.project,"/experiment/").concat(e,"/group/assignment"),u={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var o=new XMLHttpRequest;o.open("POST",s,!0),o.timeout=_e.requestTimeoutMs,Object.keys(u).map((function(e){return o.setRequestHeader(e,u[e])})),o.onload=function(){if(o.status>=200&&o.status<300){var a=JSON.parse(o.responseText);a.user?(i=a.user,Ne(n,a.user,_e.userIdCacheDurationHours)):a.user=i,a.reasonCode=a.reason_code,delete a.reason_code,a.expirationTime=(new Date).getTime()+60*_e.groupAssignmentCacheDurationHours*60*1e3,Ge(t,a),e(a)}else r(new Error(o.statusText))},o.ontimeout=function(){r(new Error("request timeout"))},o.onerror=function(){r(new Error("unable to connect to hypo servers"))},o.onabort=function(){r(new Error("request aborted"))},o.send(a)}))},event:function(e,r){var t={user:Fe(),event:e};null!=r&&(t.revenue=r);var n="".concat(_e.baseUrl,"/project/").concat(_e.project,"/event"),i=JSON.stringify(t),o={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var t=new XMLHttpRequest;t.open("POST",n,!0),t.timeout=_e.requestTimeoutMs,Object.keys(o).map((function(e){return t.setRequestHeader(e,o[e])})),t.onload=function(){t.status>=200&&t.status<300?e():r(new Error(t.statusText))},t.ontimeout=function(){r(new Error("request timeout"))},t.onerror=function(){r(new Error("unable to connect to hypo servers"))},t.onabort=function(){r(new Error("request aborted"))},t.send(i)}))}}}));
