!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).hypo={})}(this,(function(e){"use strict";var r=require("../internals/export"),t=require("../internals/fails"),n=require("../internals/is-array"),i=require("../internals/is-object"),o=require("../internals/to-object"),a=require("../internals/to-length"),s=require("../internals/create-property"),u=require("../internals/array-species-create"),c=require("../internals/array-method-has-species-support"),l=require("../internals/well-known-symbol"),f=require("../internals/v8-version"),p=l("isConcatSpreadable"),v=f>=51||!t((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),d=c("concat"),h=function(e){if(!i(e))return!1;var r=e[p];return void 0!==r?!!r:n(e)};r({target:"Array",proto:!0,forced:!v||!d},{concat:function(e){var r,t,n,i,c,l=o(this),f=u(l,0),p=0;for(r=-1,n=arguments.length;r<n;r++)if(c=-1===r?l:arguments[r],h(c)){if(p+(i=a(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(t=0;t<i;t++,p++)t in c&&s(f,p,c[t])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");s(f,p++,c)}return f.length=p,f}});var m=require("../internals/export"),q=require("../internals/array-iteration").map,g=require("../internals/fails"),y=require("../internals/array-method-has-species-support")("map"),b=y&&!g((function(){[].map.call({length:-1,0:1},(function(e){throw e}))}));m({target:"Array",proto:!0,forced:!y||!b},{map:function(e){return q(this,e,arguments.length>1?arguments[1]:void 0)}});var j=require("../internals/redefine"),w=Date.prototype,x=w.toString,k=w.getTime;new Date(NaN)+""!="Invalid Date"&&j(w,"toString",(function(){var e=k.call(this);return e==e?x.call(this):"Invalid Date"}));var O=require("../internals/export"),P=require("../internals/to-object"),E=require("../internals/object-keys");O({target:"Object",stat:!0,forced:require("../internals/fails")((function(){E(1)}))},{keys:function(e){return E(P(e))}});var D=require("../internals/to-string-tag-support"),S=require("../internals/redefine"),T=require("../internals/object-to-string");D||S(Object.prototype,"toString",T,{unsafe:!0});var H,I,C,M,R=require("../internals/export"),U=require("../internals/is-pure"),A=require("../internals/global"),N=require("../internals/get-built-in"),X=require("../internals/native-promise-constructor"),J=require("../internals/redefine"),G=require("../internals/redefine-all"),L=require("../internals/set-to-string-tag"),_=require("../internals/set-species"),F=require("../internals/is-object"),V=require("../internals/a-function"),$=require("../internals/an-instance"),z=require("../internals/classof-raw"),B=require("../internals/inspect-source"),K=require("../internals/iterate"),Q=require("../internals/check-correctness-of-iteration"),W=require("../internals/species-constructor"),Y=require("../internals/task").set,Z=require("../internals/microtask"),ee=require("../internals/promise-resolve"),re=require("../internals/host-report-errors"),te=require("../internals/new-promise-capability"),ne=require("../internals/perform"),ie=require("../internals/internal-state"),oe=require("../internals/is-forced"),ae=require("../internals/well-known-symbol"),se=require("../internals/v8-version"),ue=ae("species"),ce="Promise",le=ie.get,fe=ie.set,pe=ie.getterFor(ce),ve=X,de=A.TypeError,he=A.document,me=A.process,qe=N("fetch"),ge=te.f,ye=ge,be="process"==z(me),je=!!(he&&he.createEvent&&A.dispatchEvent),we=oe(ce,(function(){if(!(B(ve)!==String(ve))){if(66===se)return!0;if(!be&&"function"!=typeof PromiseRejectionEvent)return!0}if(U&&!ve.prototype.finally)return!0;if(se>=51&&/native code/.test(ve))return!1;var e=ve.resolve(1),r=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ue]=r,!(e.then((function(){}))instanceof r)})),xe=we||!Q((function(e){ve.all(e).catch((function(){}))})),ke=function(e){var r;return!(!F(e)||"function"!=typeof(r=e.then))&&r},Oe=function(e,r,t){if(!r.notified){r.notified=!0;var n=r.reactions;Z((function(){for(var i=r.value,o=1==r.state,a=0;n.length>a;){var s,u,c,l=n[a++],f=o?l.ok:l.fail,p=l.resolve,v=l.reject,d=l.domain;try{f?(o||(2===r.rejection&&Se(e,r),r.rejection=1),!0===f?s=i:(d&&d.enter(),s=f(i),d&&(d.exit(),c=!0)),s===l.promise?v(de("Promise-chain cycle")):(u=ke(s))?u.call(s,p,v):p(s)):v(i)}catch(e){d&&!c&&d.exit(),v(e)}}r.reactions=[],r.notified=!1,t&&!r.rejection&&Ee(e,r)}))}},Pe=function(e,r,t){var n,i;je?((n=he.createEvent("Event")).promise=r,n.reason=t,n.initEvent(e,!1,!0),A.dispatchEvent(n)):n={promise:r,reason:t},(i=A["on"+e])?i(n):"unhandledrejection"===e&&re("Unhandled promise rejection",t)},Ee=function(e,r){Y.call(A,(function(){var t,n=r.value;if(De(r)&&(t=ne((function(){be?me.emit("unhandledRejection",n,e):Pe("unhandledrejection",e,n)})),r.rejection=be||De(r)?2:1,t.error))throw t.value}))},De=function(e){return 1!==e.rejection&&!e.parent},Se=function(e,r){Y.call(A,(function(){be?me.emit("rejectionHandled",e):Pe("rejectionhandled",e,r.value)}))},Te=function(e,r,t,n){return function(i){e(r,t,i,n)}},He=function(e,r,t,n){r.done||(r.done=!0,n&&(r=n),r.value=t,r.state=2,Oe(e,r,!0))},Ie=function(e,r,t,n){if(!r.done){r.done=!0,n&&(r=n);try{if(e===t)throw de("Promise can't be resolved itself");var i=ke(t);i?Z((function(){var n={done:!1};try{i.call(t,Te(Ie,e,n,r),Te(He,e,n,r))}catch(t){He(e,n,t,r)}})):(r.value=t,r.state=1,Oe(e,r,!1))}catch(t){He(e,{done:!1},t,r)}}};we&&(ve=function(e){$(this,ve,ce),V(e),H.call(this);var r=le(this);try{e(Te(Ie,this,r),Te(He,this,r))}catch(e){He(this,r,e)}},(H=function(e){fe(this,{type:ce,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=G(ve.prototype,{then:function(e,r){var t=pe(this),n=ge(W(this,ve));return n.ok="function"!=typeof e||e,n.fail="function"==typeof r&&r,n.domain=be?me.domain:void 0,t.parent=!0,t.reactions.push(n),0!=t.state&&Oe(this,t,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),I=function(){var e=new H,r=le(e);this.promise=e,this.resolve=Te(Ie,e,r),this.reject=Te(He,e,r)},te.f=ge=function(e){return e===ve||e===C?new I(e):ye(e)},U||"function"!=typeof X||(M=X.prototype.then,J(X.prototype,"then",(function(e,r){var t=this;return new ve((function(e,r){M.call(t,e,r)})).then(e,r)}),{unsafe:!0}),"function"==typeof qe&&R({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return ee(ve,qe.apply(A,arguments))}}))),R({global:!0,wrap:!0,forced:we},{Promise:ve}),L(ve,ce,!1,!0),_(ce),C=N(ce),R({target:ce,stat:!0,forced:we},{reject:function(e){var r=ge(this);return r.reject.call(void 0,e),r.promise}}),R({target:ce,stat:!0,forced:U||we},{resolve:function(e){return ee(U&&this===C?ve:this,e)}}),R({target:ce,stat:!0,forced:xe},{all:function(e){var r=this,t=ge(r),n=t.resolve,i=t.reject,o=ne((function(){var t=V(r.resolve),o=[],a=0,s=1;K(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,t.call(r,e).then((function(e){c||(c=!0,o[u]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),t.promise},race:function(e){var r=this,t=ge(r),n=t.reject,i=ne((function(){var i=V(r.resolve);K(e,(function(e){i.call(r,e).then(t.resolve,n)}))}));return i.error&&n(i.value),t.promise}});var Ce=require("../internals/export"),Me=require("../internals/regexp-exec");Ce({target:"RegExp",proto:!0,forced:/./.exec!==Me},{exec:Me});var Re=require("../internals/fix-regexp-well-known-symbol-logic"),Ue=require("../internals/an-object"),Ae=require("../internals/to-length"),Ne=require("../internals/require-object-coercible"),Xe=require("../internals/advance-string-index"),Je=require("../internals/regexp-exec-abstract");function Ge(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Le(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _e(e){var r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return r?r[2]:null}function Fe(e,r,t){var n=new Date;n.setTime(n.getTime()+36e5*t);var i=e+"="+r+";path=/;expires="+n.toGMTString();$e.cookieDomain&&(i+=";domain="+$e.cookieDomain),document.cookie=i}Re("match",1,(function(e,r,t){return[function(r){var t=Ne(this),n=null==r?void 0:r[e];return void 0!==n?n.call(r,t):new RegExp(r)[e](String(t))},function(e){var n=t(r,e,this);if(n.done)return n.value;var i=Ue(e),o=String(this);if(!i.global)return Je(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],c=0;null!==(s=Je(i,o));){var l=String(s[0]);u[c]=l,""===l&&(i.lastIndex=Xe(o,Ae(i.lastIndex),a)),c++}return 0===c?null:u}]}));var Ve="0.0.1",$e={cookiePrefix:"hypo",baseUrl:"https://api.hypo.app",project:null,userIdCookieDurationHours:17520,groupAssignmentCookieDurationHours:6,cookieDomain:null,requestTimeoutMs:5e3};function ze(){return _e($e.cookiePrefix+"-uid")}function Be(){return{"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":Ve}}e.event=function(e,r){var t={user:ze(),event:e};null!=r&&(t.revenue=r);var n="".concat($e.baseUrl,"/project/").concat($e.project,"/event"),i=JSON.stringify(t),o=Be();return new Promise((function(e,r){var t=new XMLHttpRequest;t.open("POST",n,!0),t.timeout=$e.requestTimeoutMs,Object.keys(o).map((function(e){return t.setRequestHeader(e,o[e])})),t.onload=function(){t.status>=200&&t.status<300?e():r(new Error(t.statusText))},t.ontimeout=function(){r(new Error("request timeout"))},t.onerror=function(){r(new Error("unable to connect to hypo servers"))},t.onabort=function(){r(new Error("request aborted"))},t.send(i)}))},e.getGroupAssignment=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=$e.cookiePrefix+"-eid-"+e,n=$e.cookiePrefix+"-uid",i=_e(t);if(i&&!r)return Promise.resolve(i);var o=ze(),a="{}";o&&(a=JSON.stringify({user:o}));var s="".concat($e.baseUrl,"/project/").concat($e.project,"/experiment/").concat(e,"/group/assignment"),u=Be();return new Promise((function(e,r){var i=new XMLHttpRequest;i.open("POST",s,!0),i.timeout=$e.requestTimeoutMs,Object.keys(u).map((function(e){return i.setRequestHeader(e,u[e])})),i.onload=function(){if(i.status>=200&&i.status<300){var o=JSON.parse(i.responseText);o.user&&Fe(n,o.user,$e.userIdCookieDurationHours),Fe(t,o.group,$e.groupAssignmentCookieDurationHours),e(o.group)}else r(new Error(i.statusText))},i.ontimeout=function(){r(new Error("request timeout"))},i.onerror=function(){r(new Error("unable to connect to hypo servers"))},i.onabort=function(){r(new Error("request aborted"))},i.send(a)}))},e.getUserId=ze,e.init=function(e){$e=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Le(Object(t),!0).forEach((function(r){Ge(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Le(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},$e,{},e)},e.setUserId=function(e){Fe($e.cookiePrefix+"-uid",e,$e.userIdCookieDurationHours)},Object.defineProperty(e,"__esModule",{value:!0})}));
