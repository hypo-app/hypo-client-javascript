!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).hypo=r()}(this,(function(){"use strict";var e=require("../internals/export"),r=require("../internals/fails"),n=require("../internals/is-array"),t=require("../internals/is-object"),i=require("../internals/to-object"),o=require("../internals/to-length"),a=require("../internals/create-property"),u=require("../internals/array-species-create"),s=require("../internals/array-method-has-species-support"),c=require("../internals/well-known-symbol"),l=require("../internals/engine-v8-version"),f=c("isConcatSpreadable"),p=l>=51||!r((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),d=s("concat"),v=function(e){if(!t(e))return!1;var r=e[f];return void 0!==r?!!r:n(e)};e({target:"Array",proto:!0,forced:!p||!d},{concat:function(e){var r,n,t,s,c,l=i(this),f=u(l,0),p=0;for(r=-1,t=arguments.length;r<t;r++)if(c=-1===r?l:arguments[r],v(c)){if(p+(s=o(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<s;n++,p++)n in c&&a(f,p,c[n])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");a(f,p++,c)}return f.length=p,f}});var h=require("../internals/export"),m=require("../internals/array-iteration").map,g=require("../internals/array-method-has-species-support"),y=require("../internals/array-method-uses-to-length"),q=g("map"),w=y("map");h({target:"Array",proto:!0,forced:!q||!w},{map:function(e){return m(this,e,arguments.length>1?arguments[1]:void 0)}});var b=require("../internals/export"),j=require("../internals/to-object"),x=require("../internals/object-keys");b({target:"Object",stat:!0,forced:require("../internals/fails")((function(){x(1)}))},{keys:function(e){return x(j(e))}});var O=require("../internals/to-string-tag-support"),k=require("../internals/redefine"),P=require("../internals/object-to-string");O||k(Object.prototype,"toString",P,{unsafe:!0});var E,S,T,D,H=require("../internals/export"),C=require("../internals/is-pure"),I=require("../internals/global"),M=require("../internals/get-built-in"),R=require("../internals/native-promise-constructor"),U=require("../internals/redefine"),X=require("../internals/redefine-all"),A=require("../internals/set-to-string-tag"),J=require("../internals/set-species"),N=require("../internals/is-object"),_=require("../internals/a-function"),B=require("../internals/an-instance"),F=require("../internals/classof-raw"),G=require("../internals/inspect-source"),K=require("../internals/iterate"),L=require("../internals/check-correctness-of-iteration"),V=require("../internals/species-constructor"),$=require("../internals/task").set,z=require("../internals/microtask"),Q=require("../internals/promise-resolve"),W=require("../internals/host-report-errors"),Y=require("../internals/new-promise-capability"),Z=require("../internals/perform"),ee=require("../internals/internal-state"),re=require("../internals/is-forced"),ne=require("../internals/well-known-symbol"),te=require("../internals/engine-v8-version"),ie=ne("species"),oe="Promise",ae=ee.get,ue=ee.set,se=ee.getterFor(oe),ce=R,le=I.TypeError,fe=I.document,pe=I.process,de=M("fetch"),ve=Y.f,he=ve,me="process"==F(pe),ge=!!(fe&&fe.createEvent&&I.dispatchEvent),ye=re(oe,(function(){if(!(G(ce)!==String(ce))){if(66===te)return!0;if(!me&&"function"!=typeof PromiseRejectionEvent)return!0}if(C&&!ce.prototype.finally)return!0;if(te>=51&&/native code/.test(ce))return!1;var e=ce.resolve(1),r=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ie]=r,!(e.then((function(){}))instanceof r)})),qe=ye||!L((function(e){ce.all(e).catch((function(){}))})),we=function(e){var r;return!(!N(e)||"function"!=typeof(r=e.then))&&r},be=function(e,r,n){if(!r.notified){r.notified=!0;var t=r.reactions;z((function(){for(var i=r.value,o=1==r.state,a=0;t.length>a;){var u,s,c,l=t[a++],f=o?l.ok:l.fail,p=l.resolve,d=l.reject,v=l.domain;try{f?(o||(2===r.rejection&&ke(e,r),r.rejection=1),!0===f?u=i:(v&&v.enter(),u=f(i),v&&(v.exit(),c=!0)),u===l.promise?d(le("Promise-chain cycle")):(s=we(u))?s.call(u,p,d):p(u)):d(i)}catch(e){v&&!c&&v.exit(),d(e)}}r.reactions=[],r.notified=!1,n&&!r.rejection&&xe(e,r)}))}},je=function(e,r,n){var t,i;ge?((t=fe.createEvent("Event")).promise=r,t.reason=n,t.initEvent(e,!1,!0),I.dispatchEvent(t)):t={promise:r,reason:n},(i=I["on"+e])?i(t):"unhandledrejection"===e&&W("Unhandled promise rejection",n)},xe=function(e,r){$.call(I,(function(){var n,t=r.value;if(Oe(r)&&(n=Z((function(){me?pe.emit("unhandledRejection",t,e):je("unhandledrejection",e,t)})),r.rejection=me||Oe(r)?2:1,n.error))throw n.value}))},Oe=function(e){return 1!==e.rejection&&!e.parent},ke=function(e,r){$.call(I,(function(){me?pe.emit("rejectionHandled",e):je("rejectionhandled",e,r.value)}))},Pe=function(e,r,n,t){return function(i){e(r,n,i,t)}},Ee=function(e,r,n,t){r.done||(r.done=!0,t&&(r=t),r.value=n,r.state=2,be(e,r,!0))},Se=function(e,r,n,t){if(!r.done){r.done=!0,t&&(r=t);try{if(e===n)throw le("Promise can't be resolved itself");var i=we(n);i?z((function(){var t={done:!1};try{i.call(n,Pe(Se,e,t,r),Pe(Ee,e,t,r))}catch(n){Ee(e,t,n,r)}})):(r.value=n,r.state=1,be(e,r,!1))}catch(n){Ee(e,{done:!1},n,r)}}};ye&&(ce=function(e){B(this,ce,oe),_(e),E.call(this);var r=ae(this);try{e(Pe(Se,this,r),Pe(Ee,this,r))}catch(e){Ee(this,r,e)}},(E=function(e){ue(this,{type:oe,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=X(ce.prototype,{then:function(e,r){var n=se(this),t=ve(V(this,ce));return t.ok="function"!=typeof e||e,t.fail="function"==typeof r&&r,t.domain=me?pe.domain:void 0,n.parent=!0,n.reactions.push(t),0!=n.state&&be(this,n,!1),t.promise},catch:function(e){return this.then(void 0,e)}}),S=function(){var e=new E,r=ae(e);this.promise=e,this.resolve=Pe(Se,e,r),this.reject=Pe(Ee,e,r)},Y.f=ve=function(e){return e===ce||e===T?new S(e):he(e)},C||"function"!=typeof R||(D=R.prototype.then,U(R.prototype,"then",(function(e,r){var n=this;return new ce((function(e,r){D.call(n,e,r)})).then(e,r)}),{unsafe:!0}),"function"==typeof de&&H({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Q(ce,de.apply(I,arguments))}}))),H({global:!0,wrap:!0,forced:ye},{Promise:ce}),A(ce,oe,!1,!0),J(oe),T=M(oe),H({target:oe,stat:!0,forced:ye},{reject:function(e){var r=ve(this);return r.reject.call(void 0,e),r.promise}}),H({target:oe,stat:!0,forced:C||ye},{resolve:function(e){return Q(C&&this===T?ce:this,e)}}),H({target:oe,stat:!0,forced:qe},{all:function(e){var r=this,n=ve(r),t=n.resolve,i=n.reject,o=Z((function(){var n=_(r.resolve),o=[],a=0,u=1;K(e,(function(e){var s=a++,c=!1;o.push(void 0),u++,n.call(r,e).then((function(e){c||(c=!0,o[s]=e,--u||t(o))}),i)})),--u||t(o)}));return o.error&&i(o.value),n.promise},race:function(e){var r=this,n=ve(r),t=n.reject,i=Z((function(){var i=_(r.resolve);K(e,(function(e){i.call(r,e).then(n.resolve,t)}))}));return i.error&&t(i.value),n.promise}});var Te=require("../internals/export"),De=require("../internals/regexp-exec");Te({target:"RegExp",proto:!0,forced:/./.exec!==De},{exec:De});var He=require("../internals/fix-regexp-well-known-symbol-logic"),Ce=require("../internals/an-object"),Ie=require("../internals/to-length"),Me=require("../internals/require-object-coercible"),Re=require("../internals/advance-string-index"),Ue=require("../internals/regexp-exec-abstract");function Xe(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function Ae(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function Je(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Ae(Object(n),!0).forEach((function(r){Xe(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function Ne(e,r,n){var t=new Date;t.setTime(t.getTime()+36e5*n);var i=e+"="+r+";path=/;expires="+t.toGMTString();Ge.cookieDomain&&(i+=";domain="+Ge.cookieDomain),document.cookie=i}function _e(e,r){"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(e,JSON.stringify(r))}function Be(e){return"undefined"!=typeof window&&window.localStorage?JSON.parse(window.localStorage.getItem(e)):null}function Fe(e){if("undefined"!=typeof window&&window.localStorage)return window.localStorage.removeItem(e)}He("match",1,(function(e,r,n){return[function(r){var n=Me(this),t=null==r?void 0:r[e];return void 0!==t?t.call(r,n):new RegExp(r)[e](String(n))},function(e){var t=n(r,e,this);if(t.done)return t.value;var i=Ce(e),o=String(this);if(!i.global)return Ue(i,o);var a=i.unicode;i.lastIndex=0;for(var u,s=[],c=0;null!==(u=Ue(i,o));){var l=String(u[0]);s[c]=l,""===l&&(i.lastIndex=Re(o,Ie(i.lastIndex),a)),c++}return 0===c?null:s}]}));var Ge={cookiePrefix:"hypo",baseUrl:"https://api.hypo.app",project:null,userIdCacheDurationHours:17520,groupAssignmentCacheDurationHours:6,cookieDomain:null,requestTimeoutMs:5e3};function Ke(){var e,r,n=Ge.cookiePrefix+"-uid";return e=n,(r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)"))?r[2]:null}return{init:function(e){Ge=Je(Je({},Ge),e)},getUserId:Ke,setUserId:function(e){Ne(Ge.cookiePrefix+"-uid",e,Ge.userIdCacheDurationHours)},getGroupAssignment:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ge.cookiePrefix+"-eid-"+e,t=Ge.cookiePrefix+"-uid",i=Ke(),o=Be(n);if(o)if((new Date).getTime()<o.expirationTime&&i===o.user){if(!r)return Promise.resolve(o)}else Fe(n);var a="{}";i&&(a=JSON.stringify({user:i}));var u="".concat(Ge.baseUrl,"/project/").concat(Ge.project,"/experiment/").concat(e,"/group/assignment"),s={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var o=new XMLHttpRequest;o.open("POST",u,!0),o.timeout=Ge.requestTimeoutMs,Object.keys(s).map((function(e){return o.setRequestHeader(e,s[e])})),o.onload=function(){if(o.status>=200&&o.status<300){var a=JSON.parse(o.responseText);a.user?(i=a.user,Ne(t,a.user,Ge.userIdCacheDurationHours)):a.user=i,a.reasonCode=a.reason_code,delete a.reason_code,a.expirationTime=(new Date).getTime()+60*Ge.groupAssignmentCacheDurationHours*60*1e3,_e(n,a),e(a)}else r(new Error(o.statusText))},o.ontimeout=function(){r(new Error("request timeout"))},o.onerror=function(){r(new Error("unable to connect to hypo servers"))},o.onabort=function(){r(new Error("request aborted"))},o.send(a)}))},event:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Ke(),t="".concat(Ge.baseUrl,"/project/").concat(Ge.project,"/event");if(!navigator.sendBeacon){var i={user:n,event:e},o=r.revenue,a=r.uniqueKey,u=r.unixTimestamp;null!=o&&(i.revenue=o),null!=a&&(i.unique_key=a),null!=u&&(i.received_at=u);var s=JSON.stringify(i),c={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var n=new XMLHttpRequest;n.open("POST",t,!0),n.timeout=Ge.requestTimeoutMs,Object.keys(c).map((function(e){return n.setRequestHeader(e,c[e])})),n.onload=function(){n.status>=200&&n.status<300?e():r(new Error(n.statusText))},n.ontimeout=function(){r(new Error("request timeout"))},n.onerror=function(){r(new Error("unable to connect to hypo servers"))},n.onabort=function(){r(new Error("request aborted"))},n.send(s)}))}var l=new FormData;l.append("uid",n),l.append("ev",e);var f=r.revenue,p=r.uniqueKey,d=r.unixTimestamp;null!=f&&l.append("rev",f),null!=p&&l.append("k",p),null!=d&&l.append("t",d),navigator.sendBeacon(t,l)}}}));
