!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).hypo={})}(this,(function(e){"use strict";var r=require("../internals/export"),t=require("../internals/fails"),n=require("../internals/is-array"),i=require("../internals/is-object"),o=require("../internals/to-object"),a=require("../internals/to-length"),s=require("../internals/create-property"),u=require("../internals/array-species-create"),c=require("../internals/array-method-has-species-support"),l=require("../internals/well-known-symbol"),f=require("../internals/engine-v8-version"),p=l("isConcatSpreadable"),d=f>=51||!t((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),v=c("concat"),h=function(e){if(!i(e))return!1;var r=e[p];return void 0!==r?!!r:n(e)};r({target:"Array",proto:!0,forced:!d||!v},{concat:function(e){var r,t,n,i,c,l=o(this),f=u(l,0),p=0;for(r=-1,n=arguments.length;r<n;r++)if(c=-1===r?l:arguments[r],h(c)){if(p+(i=a(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(t=0;t<i;t++,p++)t in c&&s(f,p,c[t])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");s(f,p++,c)}return f.length=p,f}});var m=require("../internals/export"),g=require("../internals/array-iteration").map,y=require("../internals/array-method-has-species-support"),q=require("../internals/array-method-uses-to-length"),w=y("map"),b=q("map");m({target:"Array",proto:!0,forced:!w||!b},{map:function(e){return g(this,e,arguments.length>1?arguments[1]:void 0)}});var j=require("../internals/export"),x=require("../internals/to-object"),O=require("../internals/object-keys");j({target:"Object",stat:!0,forced:require("../internals/fails")((function(){O(1)}))},{keys:function(e){return O(x(e))}});var P=require("../internals/to-string-tag-support"),k=require("../internals/redefine"),E=require("../internals/object-to-string");P||k(Object.prototype,"toString",E,{unsafe:!0});var S,T,D,H,C=require("../internals/export"),I=require("../internals/is-pure"),M=require("../internals/global"),R=require("../internals/get-built-in"),U=require("../internals/native-promise-constructor"),X=require("../internals/redefine"),A=require("../internals/redefine-all"),J=require("../internals/set-to-string-tag"),N=require("../internals/set-species"),_=require("../internals/is-object"),G=require("../internals/a-function"),L=require("../internals/an-instance"),V=require("../internals/classof-raw"),F=require("../internals/inspect-source"),$=require("../internals/iterate"),z=require("../internals/check-correctness-of-iteration"),B=require("../internals/species-constructor"),K=require("../internals/task").set,Q=require("../internals/microtask"),W=require("../internals/promise-resolve"),Y=require("../internals/host-report-errors"),Z=require("../internals/new-promise-capability"),ee=require("../internals/perform"),re=require("../internals/internal-state"),te=require("../internals/is-forced"),ne=require("../internals/well-known-symbol"),ie=require("../internals/engine-v8-version"),oe=ne("species"),ae="Promise",se=re.get,ue=re.set,ce=re.getterFor(ae),le=U,fe=M.TypeError,pe=M.document,de=M.process,ve=R("fetch"),he=Z.f,me=he,ge="process"==V(de),ye=!!(pe&&pe.createEvent&&M.dispatchEvent),qe=te(ae,(function(){if(!(F(le)!==String(le))){if(66===ie)return!0;if(!ge&&"function"!=typeof PromiseRejectionEvent)return!0}if(I&&!le.prototype.finally)return!0;if(ie>=51&&/native code/.test(le))return!1;var e=le.resolve(1),r=function(e){e((function(){}),(function(){}))};return(e.constructor={})[oe]=r,!(e.then((function(){}))instanceof r)})),we=qe||!z((function(e){le.all(e).catch((function(){}))})),be=function(e){var r;return!(!_(e)||"function"!=typeof(r=e.then))&&r},je=function(e,r,t){if(!r.notified){r.notified=!0;var n=r.reactions;Q((function(){for(var i=r.value,o=1==r.state,a=0;n.length>a;){var s,u,c,l=n[a++],f=o?l.ok:l.fail,p=l.resolve,d=l.reject,v=l.domain;try{f?(o||(2===r.rejection&&ke(e,r),r.rejection=1),!0===f?s=i:(v&&v.enter(),s=f(i),v&&(v.exit(),c=!0)),s===l.promise?d(fe("Promise-chain cycle")):(u=be(s))?u.call(s,p,d):p(s)):d(i)}catch(e){v&&!c&&v.exit(),d(e)}}r.reactions=[],r.notified=!1,t&&!r.rejection&&Oe(e,r)}))}},xe=function(e,r,t){var n,i;ye?((n=pe.createEvent("Event")).promise=r,n.reason=t,n.initEvent(e,!1,!0),M.dispatchEvent(n)):n={promise:r,reason:t},(i=M["on"+e])?i(n):"unhandledrejection"===e&&Y("Unhandled promise rejection",t)},Oe=function(e,r){K.call(M,(function(){var t,n=r.value;if(Pe(r)&&(t=ee((function(){ge?de.emit("unhandledRejection",n,e):xe("unhandledrejection",e,n)})),r.rejection=ge||Pe(r)?2:1,t.error))throw t.value}))},Pe=function(e){return 1!==e.rejection&&!e.parent},ke=function(e,r){K.call(M,(function(){ge?de.emit("rejectionHandled",e):xe("rejectionhandled",e,r.value)}))},Ee=function(e,r,t,n){return function(i){e(r,t,i,n)}},Se=function(e,r,t,n){r.done||(r.done=!0,n&&(r=n),r.value=t,r.state=2,je(e,r,!0))},Te=function(e,r,t,n){if(!r.done){r.done=!0,n&&(r=n);try{if(e===t)throw fe("Promise can't be resolved itself");var i=be(t);i?Q((function(){var n={done:!1};try{i.call(t,Ee(Te,e,n,r),Ee(Se,e,n,r))}catch(t){Se(e,n,t,r)}})):(r.value=t,r.state=1,je(e,r,!1))}catch(t){Se(e,{done:!1},t,r)}}};qe&&(le=function(e){L(this,le,ae),G(e),S.call(this);var r=se(this);try{e(Ee(Te,this,r),Ee(Se,this,r))}catch(e){Se(this,r,e)}},(S=function(e){ue(this,{type:ae,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=A(le.prototype,{then:function(e,r){var t=ce(this),n=he(B(this,le));return n.ok="function"!=typeof e||e,n.fail="function"==typeof r&&r,n.domain=ge?de.domain:void 0,t.parent=!0,t.reactions.push(n),0!=t.state&&je(this,t,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),T=function(){var e=new S,r=se(e);this.promise=e,this.resolve=Ee(Te,e,r),this.reject=Ee(Se,e,r)},Z.f=he=function(e){return e===le||e===D?new T(e):me(e)},I||"function"!=typeof U||(H=U.prototype.then,X(U.prototype,"then",(function(e,r){var t=this;return new le((function(e,r){H.call(t,e,r)})).then(e,r)}),{unsafe:!0}),"function"==typeof ve&&C({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return W(le,ve.apply(M,arguments))}}))),C({global:!0,wrap:!0,forced:qe},{Promise:le}),J(le,ae,!1,!0),N(ae),D=R(ae),C({target:ae,stat:!0,forced:qe},{reject:function(e){var r=he(this);return r.reject.call(void 0,e),r.promise}}),C({target:ae,stat:!0,forced:I||qe},{resolve:function(e){return W(I&&this===D?le:this,e)}}),C({target:ae,stat:!0,forced:we},{all:function(e){var r=this,t=he(r),n=t.resolve,i=t.reject,o=ee((function(){var t=G(r.resolve),o=[],a=0,s=1;$(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,t.call(r,e).then((function(e){c||(c=!0,o[u]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),t.promise},race:function(e){var r=this,t=he(r),n=t.reject,i=ee((function(){var i=G(r.resolve);$(e,(function(e){i.call(r,e).then(t.resolve,n)}))}));return i.error&&n(i.value),t.promise}});var De=require("../internals/export"),He=require("../internals/regexp-exec");De({target:"RegExp",proto:!0,forced:/./.exec!==He},{exec:He});var Ce=require("../internals/fix-regexp-well-known-symbol-logic"),Ie=require("../internals/an-object"),Me=require("../internals/to-length"),Re=require("../internals/require-object-coercible"),Ue=require("../internals/advance-string-index"),Xe=require("../internals/regexp-exec-abstract");function Ae(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Je(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Ne(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Je(Object(t),!0).forEach((function(r){Ae(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Je(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _e(e,r,t){var n=new Date;n.setTime(n.getTime()+36e5*t);var i=e+"="+r+";path=/;expires="+n.toGMTString();Fe.cookieDomain&&(i+=";domain="+Fe.cookieDomain),document.cookie=i}function Ge(e,r){"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(e,JSON.stringify(r))}function Le(e){return"undefined"!=typeof window&&window.localStorage?JSON.parse(window.localStorage.getItem(e)):null}function Ve(e){if("undefined"!=typeof window&&window.localStorage)return window.localStorage.removeItem(e)}Ce("match",1,(function(e,r,t){return[function(r){var t=Re(this),n=null==r?void 0:r[e];return void 0!==n?n.call(r,t):new RegExp(r)[e](String(t))},function(e){var n=t(r,e,this);if(n.done)return n.value;var i=Ie(e),o=String(this);if(!i.global)return Xe(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],c=0;null!==(s=Xe(i,o));){var l=String(s[0]);u[c]=l,""===l&&(i.lastIndex=Ue(o,Me(i.lastIndex),a)),c++}return 0===c?null:u}]}));var Fe={cookiePrefix:"hypo",baseUrl:"https://api.hypo.app",project:null,userIdCacheDurationHours:17520,groupAssignmentCacheDurationHours:6,cookieDomain:null,requestTimeoutMs:5e3};function $e(){var e,r,t=Fe.cookiePrefix+"-uid";return e=t,(r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)"))?r[2]:null}e.event=function(e,r){var t={user:$e(),event:e};null!=r&&(t.revenue=r);var n="".concat(Fe.baseUrl,"/project/").concat(Fe.project,"/event"),i=JSON.stringify(t),o={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var t=new XMLHttpRequest;t.open("POST",n,!0),t.timeout=Fe.requestTimeoutMs,Object.keys(o).map((function(e){return t.setRequestHeader(e,o[e])})),t.onload=function(){t.status>=200&&t.status<300?e():r(new Error(t.statusText))},t.ontimeout=function(){r(new Error("request timeout"))},t.onerror=function(){r(new Error("unable to connect to hypo servers"))},t.onabort=function(){r(new Error("request aborted"))},t.send(i)}))},e.getGroupAssignment=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=Fe.cookiePrefix+"-eid-"+e,n=Fe.cookiePrefix+"-uid",i=$e(),o=Le(t);if(o)if((new Date).getTime()<o.expirationTime&&i===o.user){if(!r)return Promise.resolve(o)}else Ve(t);var a="{}";i&&(a=JSON.stringify({user:i}));var s="".concat(Fe.baseUrl,"/project/").concat(Fe.project,"/experiment/").concat(e,"/group/assignment"),u={"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":"0.0.1"};return new Promise((function(e,r){var o=new XMLHttpRequest;o.open("POST",s,!0),o.timeout=Fe.requestTimeoutMs,Object.keys(u).map((function(e){return o.setRequestHeader(e,u[e])})),o.onload=function(){if(o.status>=200&&o.status<300){var a=JSON.parse(o.responseText);a.user?(i=a.user,_e(n,a.user,Fe.userIdCacheDurationHours)):a.user=i,a.reasonCode=a.reason_code,delete a.reason_code,a.expirationTime=(new Date).getTime()+60*Fe.groupAssignmentCacheDurationHours*60*1e3,Ge(t,a),e(a)}else r(new Error(o.statusText))},o.ontimeout=function(){r(new Error("request timeout"))},o.onerror=function(){r(new Error("unable to connect to hypo servers"))},o.onabort=function(){r(new Error("request aborted"))},o.send(a)}))},e.getUserId=$e,e.init=function(e){Fe=Ne(Ne({},Fe),e)},e.setUserId=function(e){_e(Fe.cookiePrefix+"-uid",e,Fe.userIdCacheDurationHours)},Object.defineProperty(e,"__esModule",{value:!0})}));
