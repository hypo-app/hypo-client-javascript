!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).hypo={})}(this,(function(e){"use strict";var r=require("../internals/export"),t=require("../internals/fails"),n=require("../internals/is-array"),i=require("../internals/is-object"),o=require("../internals/to-object"),a=require("../internals/to-length"),s=require("../internals/create-property"),u=require("../internals/array-species-create"),c=require("../internals/array-method-has-species-support"),l=require("../internals/well-known-symbol"),f=require("../internals/v8-version"),p=l("isConcatSpreadable"),v=f>=51||!t((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),d=c("concat"),h=function(e){if(!i(e))return!1;var r=e[p];return void 0!==r?!!r:n(e)};r({target:"Array",proto:!0,forced:!v||!d},{concat:function(e){var r,t,n,i,c,l=o(this),f=u(l,0),p=0;for(r=-1,n=arguments.length;r<n;r++)if(c=-1===r?l:arguments[r],h(c)){if(p+(i=a(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(t=0;t<i;t++,p++)t in c&&s(f,p,c[t])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");s(f,p++,c)}return f.length=p,f}});var g=require("../internals/export"),m=require("../internals/array-iteration").map,x=require("../internals/fails"),q=require("../internals/array-method-has-species-support")("map"),y=q&&!x((function(){[].map.call({length:-1,0:1},(function(e){throw e}))}));g({target:"Array",proto:!0,forced:!q||!y},{map:function(e){return m(this,e,arguments.length>1?arguments[1]:void 0)}});var b=require("../internals/redefine"),j=Date.prototype,w=j.toString,k=j.getTime;new Date(NaN)+""!="Invalid Date"&&b(j,"toString",(function(){var e=k.call(this);return e==e?w.call(this):"Invalid Date"}));var S=require("../internals/export"),O=require("../internals/to-object"),E=require("../internals/object-keys");S({target:"Object",stat:!0,forced:require("../internals/fails")((function(){E(1)}))},{keys:function(e){return E(O(e))}});var P=require("../internals/to-string-tag-support"),D=require("../internals/redefine"),T=require("../internals/object-to-string");P||D(Object.prototype,"toString",T,{unsafe:!0});var M,I,H,R,A=require("../internals/export"),C=require("../internals/is-pure"),$=require("../internals/global"),U=require("../internals/get-built-in"),N=require("../internals/native-promise-constructor"),X=require("../internals/redefine"),J=require("../internals/redefine-all"),G=require("../internals/set-to-string-tag"),L=require("../internals/set-species"),_=require("../internals/is-object"),F=require("../internals/a-function"),V=require("../internals/an-instance"),z=require("../internals/classof-raw"),B=require("../internals/inspect-source"),K=require("../internals/iterate"),Q=require("../internals/check-correctness-of-iteration"),W=require("../internals/species-constructor"),Y=require("../internals/task").set,Z=require("../internals/microtask"),ee=require("../internals/promise-resolve"),re=require("../internals/host-report-errors"),te=require("../internals/new-promise-capability"),ne=require("../internals/perform"),ie=require("../internals/internal-state"),oe=require("../internals/is-forced"),ae=require("../internals/well-known-symbol"),se=require("../internals/v8-version"),ue=ae("species"),ce="Promise",le=ie.get,fe=ie.set,pe=ie.getterFor(ce),ve=N,de=$.TypeError,he=$.document,ge=$.process,me=U("fetch"),xe=te.f,qe=xe,ye="process"==z(ge),be=!!(he&&he.createEvent&&$.dispatchEvent),je=oe(ce,(function(){if(!(B(ve)!==String(ve))){if(66===se)return!0;if(!ye&&"function"!=typeof PromiseRejectionEvent)return!0}if(C&&!ve.prototype.finally)return!0;if(se>=51&&/native code/.test(ve))return!1;var e=ve.resolve(1),r=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ue]=r,!(e.then((function(){}))instanceof r)})),we=je||!Q((function(e){ve.all(e).catch((function(){}))})),ke=function(e){var r;return!(!_(e)||"function"!=typeof(r=e.then))&&r},Se=function(e,r,t){if(!r.notified){r.notified=!0;var n=r.reactions;Z((function(){for(var i=r.value,o=1==r.state,a=0;n.length>a;){var s,u,c,l=n[a++],f=o?l.ok:l.fail,p=l.resolve,v=l.reject,d=l.domain;try{f?(o||(2===r.rejection&&De(e,r),r.rejection=1),!0===f?s=i:(d&&d.enter(),s=f(i),d&&(d.exit(),c=!0)),s===l.promise?v(de("Promise-chain cycle")):(u=ke(s))?u.call(s,p,v):p(s)):v(i)}catch(e){d&&!c&&d.exit(),v(e)}}r.reactions=[],r.notified=!1,t&&!r.rejection&&Ee(e,r)}))}},Oe=function(e,r,t){var n,i;be?((n=he.createEvent("Event")).promise=r,n.reason=t,n.initEvent(e,!1,!0),$.dispatchEvent(n)):n={promise:r,reason:t},(i=$["on"+e])?i(n):"unhandledrejection"===e&&re("Unhandled promise rejection",t)},Ee=function(e,r){Y.call($,(function(){var t,n=r.value;if(Pe(r)&&(t=ne((function(){ye?ge.emit("unhandledRejection",n,e):Oe("unhandledrejection",e,n)})),r.rejection=ye||Pe(r)?2:1,t.error))throw t.value}))},Pe=function(e){return 1!==e.rejection&&!e.parent},De=function(e,r){Y.call($,(function(){ye?ge.emit("rejectionHandled",e):Oe("rejectionhandled",e,r.value)}))},Te=function(e,r,t,n){return function(i){e(r,t,i,n)}},Me=function(e,r,t,n){r.done||(r.done=!0,n&&(r=n),r.value=t,r.state=2,Se(e,r,!0))},Ie=function(e,r,t,n){if(!r.done){r.done=!0,n&&(r=n);try{if(e===t)throw de("Promise can't be resolved itself");var i=ke(t);i?Z((function(){var n={done:!1};try{i.call(t,Te(Ie,e,n,r),Te(Me,e,n,r))}catch(t){Me(e,n,t,r)}})):(r.value=t,r.state=1,Se(e,r,!1))}catch(t){Me(e,{done:!1},t,r)}}};je&&(ve=function(e){V(this,ve,ce),F(e),M.call(this);var r=le(this);try{e(Te(Ie,this,r),Te(Me,this,r))}catch(e){Me(this,r,e)}},(M=function(e){fe(this,{type:ce,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=J(ve.prototype,{then:function(e,r){var t=pe(this),n=xe(W(this,ve));return n.ok="function"!=typeof e||e,n.fail="function"==typeof r&&r,n.domain=ye?ge.domain:void 0,t.parent=!0,t.reactions.push(n),0!=t.state&&Se(this,t,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),I=function(){var e=new M,r=le(e);this.promise=e,this.resolve=Te(Ie,e,r),this.reject=Te(Me,e,r)},te.f=xe=function(e){return e===ve||e===H?new I(e):qe(e)},C||"function"!=typeof N||(R=N.prototype.then,X(N.prototype,"then",(function(e,r){var t=this;return new ve((function(e,r){R.call(t,e,r)})).then(e,r)}),{unsafe:!0}),"function"==typeof me&&A({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return ee(ve,me.apply($,arguments))}}))),A({global:!0,wrap:!0,forced:je},{Promise:ve}),G(ve,ce,!1,!0),L(ce),H=U(ce),A({target:ce,stat:!0,forced:je},{reject:function(e){var r=xe(this);return r.reject.call(void 0,e),r.promise}}),A({target:ce,stat:!0,forced:C||je},{resolve:function(e){return ee(C&&this===H?ve:this,e)}}),A({target:ce,stat:!0,forced:we},{all:function(e){var r=this,t=xe(r),n=t.resolve,i=t.reject,o=ne((function(){var t=F(r.resolve),o=[],a=0,s=1;K(e,(function(e){var u=a++,c=!1;o.push(void 0),s++,t.call(r,e).then((function(e){c||(c=!0,o[u]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),t.promise},race:function(e){var r=this,t=xe(r),n=t.reject,i=ne((function(){var i=F(r.resolve);K(e,(function(e){i.call(r,e).then(t.resolve,n)}))}));return i.error&&n(i.value),t.promise}});var He=require("../internals/export"),Re=require("../internals/regexp-exec");He({target:"RegExp",proto:!0,forced:/./.exec!==Re},{exec:Re});var Ae=require("../internals/redefine"),Ce=require("../internals/an-object"),$e=require("../internals/fails"),Ue=require("../internals/regexp-flags"),Ne=RegExp.prototype,Xe=Ne.toString,Je=$e((function(){return"/a/b"!=Xe.call({source:"a",flags:"b"})})),Ge="toString"!=Xe.name;(Je||Ge)&&Ae(RegExp.prototype,"toString",(function(){var e=Ce(this),r=String(e.source),t=e.flags;return"/"+r+"/"+String(void 0===t&&e instanceof RegExp&&!("flags"in Ne)?Ue.call(e):t)}),{unsafe:!0});var Le=require("../internals/fix-regexp-well-known-symbol-logic"),_e=require("../internals/an-object"),Fe=require("../internals/to-length"),Ve=require("../internals/require-object-coercible"),ze=require("../internals/advance-string-index"),Be=require("../internals/regexp-exec-abstract");Le("match",1,(function(e,r,t){return[function(r){var t=Ve(this),n=null==r?void 0:r[e];return void 0!==n?n.call(r,t):new RegExp(r)[e](String(t))},function(e){var n=t(r,e,this);if(n.done)return n.value;var i=_e(e),o=String(this);if(!i.global)return Be(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],c=0;null!==(s=Be(i,o));){var l=String(s[0]);u[c]=l,""===l&&(i.lastIndex=ze(o,Fe(i.lastIndex),a)),c++}return 0===c?null:u}]}));var Ke=require("../internals/fix-regexp-well-known-symbol-logic"),Qe=require("../internals/an-object"),We=require("../internals/to-object"),Ye=require("../internals/to-length"),Ze=require("../internals/to-integer"),er=require("../internals/require-object-coercible"),rr=require("../internals/advance-string-index"),tr=require("../internals/regexp-exec-abstract"),nr=Math.max,ir=Math.min,or=Math.floor,ar=/\$([$&'`]|\d\d?|<[^>]*>)/g,sr=/\$([$&'`]|\d\d?)/g;function ur(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function cr(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function lr(e){var r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return r?r[2]:null}function fr(e,r,t){var n=new Date;n.setTime(n.getTime()+36e5*t);var i=e+"="+r+";path=/;expires="+n.toGMTString();vr.cookieDomain&&(i+=";domain="+vr.cookieDomain),document.cookie=i}Ke("replace",2,(function(e,r,t){return[function(t,n){var i=er(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=t(r,e,this,i);if(o.done)return o.value;var a=Qe(e),s=String(this),u="function"==typeof i;u||(i=String(i));var c=a.global;if(c){var l=a.unicode;a.lastIndex=0}for(var f=[];;){var p=tr(a,s);if(null===p)break;if(f.push(p),!c)break;""===String(p[0])&&(a.lastIndex=rr(s,Ye(a.lastIndex),l))}for(var v,d="",h=0,g=0;g<f.length;g++){p=f[g];for(var m=String(p[0]),x=nr(ir(Ze(p.index),s.length),0),q=[],y=1;y<p.length;y++)q.push(void 0===(v=p[y])?v:String(v));var b=p.groups;if(u){var j=[m].concat(q,x,s);void 0!==b&&j.push(b);var w=String(i.apply(void 0,j))}else w=n(m,s,x,q,b,i);x>=h&&(d+=s.slice(h,x)+w,h=x+m.length)}return d+s.slice(h)}];function n(e,t,n,i,o,a){var s=n+e.length,u=i.length,c=sr;return void 0!==o&&(o=We(o),c=ar),r.call(a,c,(function(r,a){var c;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(s);case"<":c=o[a.slice(1,-1)];break;default:var l=+a;if(0===l)return r;if(l>u){var f=or(l/10);return 0===f?r:f<=u?void 0===i[f-1]?a.charAt(1):i[f-1]+a.charAt(1):r}c=i[l-1]}return void 0===c?"":c}))}}));var pr="0.0.1",vr={cookiePrefix:"hypo",baseUrl:"https://api.hypo.app",project:null,userIdCookieDurationHours:17520,groupAssignmentCookieDurationHours:6,cookieDomain:null,requestTimeoutMs:5e3};function dr(){var e,r,t=lr(vr.cookiePrefix+"-uid");return t||(e=(new Date).getTime(),r=0,"undefined"!=typeof performance&&(r=performance&&performance.now&&1e3*performance.now()||0),hr(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(r+n)%16|0,r=Math.floor(r/16)),("x"===t?n:3&n|8).toString(16)})))),t}function hr(e){fr(vr.cookiePrefix+"-uid",e,vr.userIdCookieDurationHours)}function gr(){return{"Content-Type":"application/json","X-Hypo-Client":"js-web","X-Hypo-Client-Version":pr}}e.event=function(e,r){var t={user:dr(),event:e};null!=r&&(t.revenue=r);var n="".concat(vr.baseUrl,"/project/").concat(vr.project,"/event"),i=JSON.stringify(t),o=gr();return new Promise((function(e,r){var t=new XMLHttpRequest;t.open("POST",n,!0),t.timeout=vr.requestTimeoutMs,Object.keys(o).map((function(e){return t.setRequestHeader(e,o[e])})),t.onload=function(){t.status>=200&&t.status<300?e():r(new Error(t.statusText))},t.ontimeout=function(){r(new Error("request timeout"))},t.onerror=function(){r(new Error("unable to connect to hypo servers"))},t.onabort=function(){r(new Error("request aborted"))},t.send(i)}))},e.getGroupAssignment=function(e){var r=vr.cookiePrefix+"-eid-"+e,t=dr(),n=lr(r);if(n)return Promise.resolve(n);var i="".concat(vr.baseUrl,"/project/").concat(vr.project,"/experiment/").concat(e,"/group/assignment"),o=JSON.stringify({user:t}),a=gr();return new Promise((function(e,t){var n=new XMLHttpRequest;n.open("POST",i,!0),n.timeout=vr.requestTimeoutMs,Object.keys(a).map((function(e){return n.setRequestHeader(e,a[e])})),n.onload=function(){if(n.status>=200&&n.status<300){var i=JSON.parse(n.responseText);fr(r,i.group,vr.groupAssignmentCookieDurationHours),e(i.group)}else t(new Error(n.statusText))},n.ontimeout=function(){t(new Error("request timeout"))},n.onerror=function(){t(new Error("unable to connect to hypo servers"))},n.onabort=function(){t(new Error("request aborted"))},n.send(o)}))},e.getUserId=dr,e.init=function(e){vr=function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?cr(Object(t),!0).forEach((function(r){ur(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):cr(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},vr,{},e)},e.setUserId=hr,Object.defineProperty(e,"__esModule",{value:!0})}));
